import { action } from 'mobx';
import { TicketSelectionValidationError } from './../../../../../types/stores/order-store-data';
import { getSeatsCountPerAreaCategory } from './../../../services/order/utils/order-seat-utils';
import { getTicketsCountPerAreaCategory } from './../../../services/order/utils/order-ticket-utils';
import { orderStoreInstance } from './../order-store';
/**
 * Returns whether the current tickets selection comparing with selected seats is valid or not.
 */
export var validateSelectedTicketsForShowtime = action(function (showtimeId) {
    var isSeatFirstOrdering = orderStoreInstance.selectors.isSeatFirstOrderingForShowtime(showtimeId);
    return isSeatFirstOrdering
        ? validateSeatFirstTicketSelections(showtimeId)
        : validateAtLeastOneTicketIsSelected(showtimeId);
});
/**
 * Validate at least one ticket selected.
 */
function validateAtLeastOneTicketIsSelected(showtimeId) {
    if (orderStoreInstance.selectors.getSelectedTicketsCountForShowtime(showtimeId) === 0) {
        orderStoreInstance.actions.setTicketSelectionErrors([TicketSelectionValidationError.NoTicketsSelected]);
        return false;
    }
    orderStoreInstance.actions.setTicketSelectionErrors([]);
    return true;
}
function validateSeatFirstTicketSelections(showtimeId) {
    var showtime = orderStoreInstance.selectors.getShowtimeById(showtimeId);
    var selectedSeats = showtime.seats || [];
    var seatQuantityByAreaCategoryMap = getSeatsCountPerAreaCategory(selectedSeats);
    var ticketQuantityByAreaCategoryMap = getTicketsCountPerAreaCategory(showtimeId, showtime.tickets);
    var totalSeatsQuantity = orderStoreInstance.selectors.getSelectedSeatsCountForShowtime(showtimeId);
    var totalTicketsQuantity = orderStoreInstance.selectors.getSelectedTicketsCountForShowtime(showtimeId);
    var errors = new Array();
    if (totalSeatsQuantity !== totalTicketsQuantity) {
        totalSeatsQuantity < totalTicketsQuantity
            ? errors.push(TicketSelectionValidationError.TooManyTickets)
            : errors.push(TicketSelectionValidationError.TooFewTickets);
    }
    for (var areaCategoryCode in Array.from(seatQuantityByAreaCategoryMap.keys())) {
        var seatsInAreaCategoryQuantity = seatQuantityByAreaCategoryMap.get(areaCategoryCode);
        var ticketsInAreaCategoryQuantity = ticketQuantityByAreaCategoryMap.get(areaCategoryCode);
        if (seatsInAreaCategoryQuantity !== ticketsInAreaCategoryQuantity) {
            errors.push(TicketSelectionValidationError.TicketsDoNotMatchSelectedSeats);
        }
    }
    orderStoreInstance.actions.setTicketSelectionErrors(errors);
    return errors.length === 0;
}
//# sourceMappingURL=validate-selected-tickets-for-showtime.js.map